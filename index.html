<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendrier de l'Avent - Food Safety</title>
    <!-- Polices Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas:wght@700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-red: #d42426;
            --primary-green: #165b33;
            --gold: #f8b229;
            --dark-bg: #0b0c10;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            
            /* --- URLS DES IMAGES DES CASES (Vous pouvez les changer ici) --- */
            /* J'ai mis des images libres de droits pour l'exemple */
            --img-bauble: url('https://raw.githubusercontent.com/Visitune/AVENTCALIFS/main/asset/boule.png');
            --img-gift: url('https://raw.githubusercontent.com/Visitune/AVENTCALIFS/main/asset/couronne.png'); 
            --img-flake: url('https://raw.githubusercontent.com/Visitune/AVENTCALIFS/main/asset/snowflake.png');
        }

        /* LOADER */
        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--dark-bg); z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 0.5s;
        }
        .spinner {
            width: 50px; height: 50px; border: 5px solid rgba(255,255,255,0.3);
            border-top-color: var(--gold); border-radius: 50%;
            animation: spin 1s linear infinite; margin-bottom: 20px;
        }
        @keyframes spin { to {transform: rotate(360deg);} }

        body {
            margin: 0; padding: 0;
            font-family: 'Roboto', sans-serif;
            background-color: var(--dark-bg);
            /* Image par d√©faut (chargement) */
            background-image: url('https://raw.githubusercontent.com/Visitune/AVENTCALIFS/main/asset/chad-madden-SUTfFCAHV_A-unsplash.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: white;
            min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
            transition: background-image 1s ease-in-out;
        }

        body::before {
            content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.5); z-index: -1; pointer-events: none;
        }

        #snowCanvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 0;
        }

        .main-container {
            width: 100%; max-width: 1200px; padding: 2rem;
            z-index: 1; flex-grow: 1;
            display: flex; flex-direction: column; align-items: center;
        }

        header {
            text-align: center; padding: 2rem 1rem; width: 100%;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        }

        header h1 {
            font-family: 'Mountains of Christmas', cursive;
            font-size: 3.5rem; margin: 0; color: var(--gold);
        }

        /* PROGRESS BAR */
        .progress-wrap {
            width: 300px; height: 10px; background: rgba(255,255,255,0.2);
            border-radius: 5px; margin: 15px auto; overflow: hidden;
        }
        .progress-fill {
            height: 100%; background: var(--gold); width: 0%; transition: width 1s;
        }
        .progress-txt { font-size: 0.9rem; margin-top: 5px; color: #ddd; }

        /* GRILLE */
        .calendar-grid {
            display: flex; flex-wrap: wrap; justify-content: center;
            gap: 40px; width: 100%; margin-top: 30px; padding-bottom: 50px;
        }

        /* --- NOUVEAU STYLE DES BOITES (IMAGES) --- */
        .day-box {
            width: 140px; height: 140px;
            /* Plus de fond color√© CSS, place √† l'image */
            background-color: transparent; 
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; transition: transform 0.3s;
            position: relative; flex-shrink: 0;
            
            /* Ombre port√©e naturelle pour les PNG transparents */
            filter: drop-shadow(0 10px 15px rgba(0,0,0,0.5));
        }

        .day-box:hover:not(.locked) {
            transform: translateY(-10px) scale(1.1) !important;
            filter: drop-shadow(0 15px 25px rgba(248, 178, 41, 0.6)); /* Glow dor√© au survol */
            z-index: 10;
        }

        .day-number {
            font-family: 'Mountains of Christmas', cursive;
            font-size: 3rem; font-weight: bold; color: #fff;
            text-shadow: 0 0 5px black, 0 0 10px black; /* Ombre forte pour lisibilit√© sur l'image */
            z-index: 5; pointer-events: none;
            margin-top: 10px; /* Petit ajustement pour centrer visuellement */
        }

        /* Application des Images d√©finies dans :root */
        .day-box.shape-ball { background-image: var(--img-bauble); }
        .day-box.shape-gift { background-image: var(--img-gift); }
        .day-box.shape-snowflake { background-image: var(--img-flake); }

        /* ETATS */
        .locked { 
            filter: grayscale(1) brightness(0.5); 
            opacity: 0.7; cursor: not-allowed; 
        }
        .locked .day-number::after { content: 'üîí'; display: block; font-size: 1rem; text-align: center; }
        
        .past { filter: brightness(0.8) sepia(0.3); opacity: 0.9; }
        .past::after { 
            content: '‚úî'; position: absolute; bottom: 0px; right: 0px; 
            font-size: 2rem; color: #2ecc71; z-index: 20; 
            text-shadow: 2px 2px 0 #000; font-weight:bold;
        }

        .today { animation: float 3s ease-in-out infinite; z-index: 20; transform: scale(1.1); }
        @keyframes float { 
            0%, 100% { transform: translateY(0) scale(1.1); }
            50% { transform: translateY(-10px) scale(1.1); }
        }

        /* MODALE */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.9); backdrop-filter: blur(5px);
            display: flex; justify-content: center; align-items: center;
            z-index: 2000; opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        .modal.visible { opacity: 1; pointer-events: auto; }

        .modal-content {
            background: white; color: #333; padding: 2.5rem;
            border-radius: 15px; width: 90%; max-width: 600px;
            position: relative; border-top: 10px solid var(--primary-red);
            box-shadow: 0 20px 60px black; text-align: left;
        }

        .close-btn { position: absolute; top: 10px; right: 20px; font-size: 2.5rem; cursor: pointer; color: #aaa; }
        .question-text { font-size: 1.3rem; font-weight: bold; margin-bottom: 1.5rem; line-height: 1.4; border-left: 5px solid var(--gold); padding-left: 15px; }

        .option-btn {
            display: block; width: 100%; padding: 15px; margin-bottom: 10px;
            border: 2px solid #ddd; border-radius: 8px; background: white;
            cursor: pointer; font-size: 1rem; text-align: left; transition: 0.2s;
        }
        .option-btn:hover { background: #f8f8f8; border-color: var(--gold); transform: translateX(5px); }
        .option-btn.correct { background: #d4edda; border-color: #28a745; color: #155724; font-weight: bold; }
        .option-btn.incorrect { background: #f8d7da; border-color: #dc3545; color: #721c24; }

        .feedback-zone { display: none; margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee; text-align: center; }
        .download-btn {
            display: inline-block; margin-top: 10px; padding: 12px 30px;
            background: linear-gradient(to right, var(--primary-red), #b01c1e);
            color: white; text-decoration: none; border-radius: 50px;
            font-weight: bold; box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transition: transform 0.2s;
        }
        .download-btn:hover { transform: scale(1.05); }

        /* FOOTER & LOGO VISIPILOT */
        footer { 
            padding: 40px 20px; 
            text-align: center; 
            width: 100%;
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
            margin-top: auto; /* Pousse le footer en bas */
        }
        
        .logo-link img {
            height: 70px; /* Taille du logo */
            width: auto;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            transition: transform 0.3s, box-shadow 0.3s;
            background: white; /* Fond blanc propre pour le logo */
            padding: 5px;
        }
        .logo-link:hover img {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255,255,255,0.4);
        }
        .copyright {
            margin-top: 15px; font-size: 0.8rem; color: #aaa;
        }

    </style>
</head>
<body>

    <div id="loader">
        <div class="spinner"></div>
        <div style="color:var(--gold); font-family:'Montserrat';">Chargement...</div>
    </div>

    <audio id="snd-win" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>
    <audio id="snd-fail" src="https://assets.mixkit.co/active_storage/sfx/2003/2003-preview.mp3"></audio>

    <canvas id="snowCanvas"></canvas>

    <div class="main-container">
        <header>
            <h1>Calendrier Food Safety</h1>
            <p>Challenge Qualit√© & S√©curit√© üéÑ</p>
            <div class="progress-wrap">
                <div class="progress-fill" id="progressBar"></div>
            </div>
            <div class="progress-txt">Progression: <span id="progressTxt">0/25</span></div>
        </header>

        <div class="calendar-grid" id="grid">
            <!-- JS injectera les cases (images) ici -->
        </div>

        <footer>
            <!-- LOGO VISIPILOT CLIQUABLE -->
            <a href="https://visipilot.com" target="_blank" class="logo-link" title="Visitez Visipilot.com">
                <!-- Lien RAW GitHub pour l'image -->
                <img src="https://raw.githubusercontent.com/M00N69/BUSCAR/main/logo%2002%20copie.jpg" alt="Logo Visipilot">
            </a>
            <div class="copyright">¬© 2024 - √âquipe Food Safety</div>
        </footer>
    </div>

    <div class="modal" id="quizModal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <h3 id="m-day" style="color:var(--primary-green); margin-top:0;">Jour X</h3>
            <div class="question-text" id="m-question">...</div>
            <div id="m-options"></div>
            
            <div class="feedback-zone" id="m-feedback">
                <p id="m-exp" style="margin-bottom:10px;"></p>
                <a href="#" class="download-btn" id="m-link" target="_blank">üéÅ T√©l√©charger la Ressource</a>
            </div>
        </div>
    </div>

    <script>
        // CONFIGURATION
        const MODE_DEMO = false; 

        // ‚ö†Ô∏è COLLEZ ICI VOTRE JSON G√âN√âR√â PAR ADMIN.HTML
        const QUIZ_DATA = [
            {
                "day": 1,
                "q": "Selon l'article 18 du R√®glement (CE) n¬∞ 178/2002, quelle est l'exigence minimale de tra√ßabilit√© pour les exploitants du secteur alimentaire ?",
                "o": [
                    "Tra√ßabilit√© interne compl√®te incluant les param√®tres de cuisson",
                    "Tra√ßabilit√© 'un pas en avant, un pas en arri√®re' (Fournisseur imm√©diat et Client imm√©diat)",
                    "Tra√ßabilit√© jusqu'au consommateur final individuel",
                    "Tra√ßabilit√© uniquement des mati√®res premi√®res import√©es"
                ],
                "a": 1,
                "exp": "Le r√®glement impose d'√™tre capable d'identifier toute personne ayant fourni une denr√©e et toute entreprise √† laquelle leurs produits ont √©t√© fournis (One step up, one step down).",
                "f": "Fruits&legumes.pdf",
                "l": "https://drive.google.com/uc?export=download&id=1cImnlyysvEVehhSkt1WzEMrUII44i3Gi"
            },
            {
                "day": 2,
                "q": "Quelle est la taille minimale des caract√®res (hauteur de x) pour les mentions obligatoires sur un emballage standard (>80cm¬≤) selon le R√®glement INCO 1169/2011 ?",
                "o": [
                    "0,9 mm",
                    "1,2 mm",
                    "2,0 mm",
                    "3,0 mm"
                ],
                "a": 1,
                "exp": "Le R√®glement (UE) n¬∞ 1169/2011 impose une taille de caract√®res minimale de 1,2 mm pour garantir la lisibilit√© des informations obligatoires.",
                "f": "emballageF&L.pdf",
                "l": "https://drive.google.com/uc?export=download&id=171TtyDW9Mo9P7SGD11BU38ra9DKQCv0s"
            },
            {
                "day": 3,
                "q": "Selon le R√®glement (CE) n¬∞ 2073/2005, quel est le crit√®re de s√©curit√© pour Listeria monocytogenes dans les produits pr√™ts √† consommer permettant sa croissance, avant sortie d'usine ?",
                "o": [
                    "Absence dans 25 g",
                    "100 UFC/g",
                    "1000 UFC/g",
                    "Absence dans 10 g"
                ],
                "a": 0,
                "exp": "Si le producteur ne peut pas d√©montrer que le niveau restera <100 UFC/g jusqu'√† la fin de la DLC, l'exigence est l'absence dans 25 g √† la sortie de production.",
                "f": "Lsiteria1.pdf",
                "l": "https://drive.google.com/uc?export=download&id=1yCWKZ6lLnffyNCi-3gS0Dgn6_60ysK1X"
            },
            {
                "day": 4,
                "q": "Combien de principes fondamentaux composent le syst√®me HACCP selon le Codex Alimentarius ?",
                "o": [
                    "5 principes",
                    "7 principes",
                    "12 principes",
                    "14 principes"
                ],
                "a": 1,
                "exp": "Le syst√®me HACCP repose sur 7 principes (Analyse des dangers, CCP, Limites critiques, Surveillance, Actions correctives, V√©rification, Documentation). Les 12 √©tapes incluent la pr√©paration.",
                "f": "CODEX.pdf",
                "l": "https://drive.google.com/uc?export=download&id=1XecFfLnrmpVqM-Fq9UfkbwWHRAG8J21s"
            },
            {
                "day": 5,
                "q": "Selon le R√®glement (UE) 2017/625 (OCR), sur quoi doit √™tre bas√©e la fr√©quence des contr√¥les officiels ?",
                "o": [
                    "Uniquement sur la taille de l'entreprise",
                    "Sur le risque associ√© aux animaux et denr√©es, et sur les ant√©c√©dents de l'op√©rateur",
                    "Sur un tirage au sort al√©atoire",
                    "Sur le chiffre d'affaires de l'entreprise"
                ],
                "a": 1,
                "exp": "Les contr√¥les officiels doivent √™tre r√©guliers, inopin√©s et bas√©s sur le risque (type de produit, process, historique de conformit√© de l'op√©rateur).",
                "f": "DGALertepdf",
                "l": "https://drive.google.com/uc?export=download&id=12xeHAczovwrfhrJsTbMW5ipCpCfVqdVM"
            },
            {
                "day": 6,
                "q": "Quel r√®glement cadre d√©finit les principes g√©n√©raux pour tous les mat√©riaux destin√©s √† entrer en contact avec des denr√©es alimentaires (MCDA) ?",
                "o": [
                    "R√®glement (UE) n¬∞ 10/2011",
                    "R√®glement (CE) n¬∞ 1935/2004",
                    "R√®glement (CE) n¬∞ 2023/2006",
                    "Directive 94/62/CE"
                ],
                "a": 1,
                "exp": "Le R√®glement (CE) n¬∞ 1935/2004 est le r√®glement cadre qui pose le principe d'inertie des mat√©riaux (ne pas c√©der de constituants en quantit√© dangereuse).",
                "f": "MCDAtotal.pdf",
                "l": "https://drive.google.com/uc?export=download&id=1W9HydBUTBTpo_Wp91zSa-2qo0xwhp2bE"
            },
            {
                "day": 7,
                "q": "Quelle est la temp√©rature maximale autoris√©e pour le transport des produits surgel√©s selon la Directive 89/108/CEE ?",
                "o": [
                    "-12¬∞C",
                    "-18¬∞C",
                    "-24¬∞C",
                    "-4¬∞C"
                ],
                "a": 1,
                "exp": "La temp√©rature des aliments surgel√©s doit √™tre maintenue √† -18¬∞C ou moins, avec de br√®ves fluctuations tol√©r√©es de maximum 3¬∞C pendant le transport.",
                "f": "PFAS.pdf",
                "l": "https://drive.google.com/uc?export=download&id=1jq6qIm0GptUc_-MqcsPYWSaVgZSs2NJ9"
            },
            {
                "day": 8,
                "q": "Selon le R√®glement (UE) 2018/775, quand l'origine de l'ingr√©dient primaire doit-elle √™tre indiqu√©e ?",
                "o": [
                    "Toujours, pour tous les produits",
                    "Lorsque l'origine du produit fini est indiqu√©e et qu'elle diff√®re de celle de son ingr√©dient primaire",
                    "Uniquement pour les produits carn√©s",
                    "Jamais, c'est facultatif"
                ],
                "a": 1,
                "exp": "Si un produit affiche 'Fabriqu√© en France' mais que son ingr√©dient principal (ex: lait, viande) vient d'ailleurs, cette origine diff√©rente doit √™tre pr√©cis√©e.",
                "f": "FDArisk.pdf",
                "l": "https://drive.google.com/uc?export=download&id=1VgibfswZdQ9pT9nh0DtH_79UcZTtuFsY"
            },
            {
                "day": 9,
                "q": "Quel r√®glement a remplac√© le r√®glement 1881/2006 concernant les teneurs maximales en contaminants (m√©taux lourds, mycotoxines) ?",
                "o": [
                    "R√®glement (UE) 2023/915",
                    "R√®glement (CE) 396/2005",
                    "R√®glement (CE) 852/2004",
                    "R√®glement (UE) 2017/2158"
                ],
                "a": 0,
                "exp": "Le R√®glement (UE) 2023/915 a abrog√© et remplac√© le 1881/2006 pour consolider et mettre √† jour les limites de contaminants.",
                "f": "pesticideFrance.pdf",
                "l": "https://drive.google.com/uc?export=download&id=1vat-BFJtB9MgjPAg8xI5uqJNiRb6vNS3"
            },
            {
                "day": 10,
                "q": "Selon l'Annexe II du R√®glement 1169/2011, combien de substances ou produits provoquant des allergies ou intol√©rances sont √† d√©claration obligatoire ?",
                "o": [
                    "8",
                    "10",
                    "12",
                    "14"
                ],
                "a": 3,
                "exp": "Il existe 14 allerg√®nes majeurs (ex: gluten, crustac√©s, ≈ìufs, poisson, arachides, soja, lait, fruits √† coque, c√©leri, moutarde, s√©same, sulfites, lupin, mollusques).",
                "f": "allergen.pdf",
                "l": "https://drive.google.com/uc?export=download&id=1v4ZLPSUyHRRWxcXqmQB2uHw_Fh3PINvt"
            },
            {
                "day": 11,
                "q": "Selon le R√®glement (CE) n¬∞ 853/2004, quelle est la temp√©rature maximale de conservation des viandes hach√©es ?",
                "o": [
                    "0¬∞C",
                    "2¬∞C",
                    "4¬∞C",
                    "7¬∞C"
                ],
                "a": 1,
                "exp": "Le r√®glement sp√©cifique aux denr√©es animales (853/2004) fixe la limite √† 2¬∞C pour les viandes hach√©es et 4¬∞C pour les pr√©parations de viandes.",
                "f": "crisefromage.pdf",
                "l": "https://drive.google.com/uc?export=download&id=1Do4u2VdzeJn6d_NSh0fLtcQvXd7yUJan"
            },
            {
                "day": 12,
                "q": "Quel est le seuil de pr√©sence accidentelle d'OGM autoris√©s au-del√† duquel l'√©tiquetage 'Contient des OGM' devient obligatoire (R√®glement 1829/2003) ?",
                "o": [
                    "0,1 %",
                    "0,5 %",
                    "0,9 %",
                    "1,0 %"
                ],
                "a": 2,
                "exp": "L'√©tiquetage n'est pas requis si la pr√©sence est accidentelle ou techniquement in√©vitable et inf√©rieure √† 0,9 % des ingr√©dients consid√©r√©s.",
                "f": "France pesticide.pdf",
                "l": "https://drive.google.com/uc?export=download&id=1bGTswV-6iiuOgen2cJcPZbWXfHk1ODt3"
            },
            {
                "day": 13,
                "q": "Dans le cadre du nettoyage industriel (Cercle de Sinner), quels sont les 4 facteurs interd√©pendants ?",
                "o": [
                    "Temps, Temp√©rature, Action Chimique, Action M√©canique",
                    "Prix, Qualit√©, S√©curit√©, Environnement",
                    "Eau, Air, Surface, D√©tergent",
                    "pH, Conductivit√©, Densit√©, Viscosit√©"
                ],
                "a": 0,
                "exp": "Le cercle de Sinner stipule que la diminution d'un facteur (ex: temp√©rature) doit √™tre compens√©e par l'augmentation d'un autre (ex: temps ou concentration chimique).",
                "f": "tuyaux.pdf",
                "l": "https://drive.google.com/uc?export=download&id=1ABKlRVC8wc2Ej9naPOJCSmRbUCobek-L"
            },
            {
                "day": 14,
                "q": "Selon le R√®glement (CE) n¬∞ 1924/2006, une all√©gation nutritionnelle 'Source de fibres' n√©cessite une teneur minimale de :",
                "o": [
                    "1,5 g de fibres pour 100 g",
                    "3 g de fibres pour 100 g",
                    "6 g de fibres pour 100 g",
                    "10 g de fibres pour 100 g"
                ],
                "a": 1,
                "exp": "L'all√©gation 'Source de fibres' n'est possible que si le produit contient au moins 3 g de fibres par 100 g (ou 1,5 g par 100 kcal).",
                "f": "allegationsant√©.pdf",
                "l": "https://drive.google.com/uc?export=download&id=1Z10ap-QPtITxEzTgflbLXLk-rDbX6end"
            },
            {
                "day": 15,
                "q": "Quel r√®glement impose aux entreprises du secteur alimentaire d'appliquer des mesures d'att√©nuation pour r√©duire la pr√©sence d'acrylamide ?",
                "o": [
                    "R√®glement (UE) 2017/2158",
                    "R√®glement (CE) 178/2002",
                    "R√®glement (CE) 852/2004",
                    "Directive 2002/46/CE"
                ],
                "a": 0,
                "exp": "Ce r√®glement √©tablit des mesures d'att√©nuation et des teneurs de r√©f√©rence pour r√©duire l'acrylamide dans les frites, le pain, le caf√©, etc.",
                "f": "oxydetitane.pdf",
                "l": "https://drive.google.com/uc?export=download&id=11OtLzDKqJORKB4NnWs3P6r2upjQei7L-"
            },
            {
                "day": 16,
                "q": "Selon le R√®glement (CE) n¬∞ 396/2005, qu'est-ce qu'une LMR ?",
                "o": [
                    "Limite Minimale Requise pour les nutriments",
                    "Limite Maximale de R√©sidus de pesticides autoris√©e",
                    "Limite Moyenne de R√©frig√©ration",
                    "Liste des Mat√©riaux Recyclables"
                ],
                "a": 1,
                "exp": "La LMR est la concentration maximale de r√©sidus de pesticides autoris√©e dans ou sur les denr√©es alimentaires.",
                "f": "IFStrendrisk.pdf",
                "l": "https://drive.google.com/uc?export=download&id=178g4ItFZBMS4mJlJTs4jPjtewy9Vds3H"
            },
            {
                "day": 17,
                "q": "Quel est le principe de la 'Migration Globale' pour les emballages plastiques selon le R√®glement (UE) 10/2011 ?",
                "o": [
                    "La migration sp√©cifique du Bisph√©nol A",
                    "La quantit√© totale de substances non-volatiles migrant du mat√©riau vers l'aliment",
                    "Le passage de l'encre √† travers le carton",
                    "Le recyclage du plastique"
                ],
                "a": 1,
                "exp": "La limite de migration globale (g√©n√©ralement 10 mg/dm¬≤) mesure l'inertie globale du mat√©riau, sans identifier les substances sp√©cifiques.",
                "f": "foodfraudvisipilot.pdf",
                "l": "https://drive.google.com/uc?export=download&id=1mZft6XU0PtmIuPhvj9szGf79-9lf7o7d"
            },
            {
                "day": 18,
                "q": "Selon le R√®glement (CE) n¬∞ 178/2002 (Article 19), quelle est la premi√®re action obligatoire si un exploitant consid√®re qu'une denr√©e import√©e n'est pas s√ªre ?",
                "o": [
                    "D√©truire le lot discr√®tement",
                    "Attendre les plaintes clients",
                    "Engager imm√©diatement les proc√©dures de retrait et informer les autorit√©s comp√©tentes",
                    "Vendre le produit en promotion"
                ],
                "a": 2,
                "exp": "L'article 19 impose le retrait imm√©diat (et le rappel si le produit a atteint le consommateur) ainsi que la notification officielle aux autorit√©s.",
                "f": "iso22002-1.pdf",
                "l": "https://drive.google.com/uc?export=download&id=1cDnVzRzg-NmDpZ0zoqEVYREOT17IBCm7"
            },
            {
                "day": 19,
                "q": "Selon le R√®glement (UE) 2018/848, l'utilisation d'OGM est-elle autoris√©e en production biologique ?",
                "o": [
                    "Oui, sans restriction",
                    "Oui, si c'est pour l'alimentation animale",
                    "Non, l'utilisation d'OGM et de produits d√©riv√©s d'OGM est interdite",
                    "Oui, si < 5%"
                ],
                "a": 2,
                "exp": "L'interdiction des OGM est un principe fondamental de la production biologique (avec une tol√©rance uniquement pour la pr√©sence accidentelle < 0,9%).",
                "f": "ISO22002027.pdf",
                "l": "https://drive.google.com/uc?export=download&id=1Z8oozvJgsRLCzVqBYfQWz7GliUCzb66D"
            },
            {
                "day": 20,
                "q": "Selon le R√®glement 852/2004, l'analyse des dangers HACCP doit prendre en compte quels types de dangers ?",
                "o": [
                    "Uniquement microbiologiques",
                    "Biologiques, Chimiques et Physiques",
                    "Uniquement les allerg√®nes",
                    "Uniquement les corps √©trangers"
                ],
                "a": 1,
                "exp": "Le plan HACCP doit identifier, √©valuer et ma√Ætriser les dangers significatifs au regard de la s√©curit√© des aliments : biologiques, chimiques (dont allerg√®nes) et physiques.",
                "f": "detecteurmetaux.pdf",
                "l": "https://drive.google.com/uc?export=download&id=1xQQsHcwyuXe76N-NpkMrvukiQQE9V0zz"
            },
            {
                "day": 21,
                "q": "En atmosph√®re modifi√©e (MAP), quel gaz est principalement utilis√© pour ses propri√©t√©s bact√©riostatiques (inhibe la croissance) ?",
                "o": [
                    "Azote (N2)",
                    "Oxyg√®ne (O2)",
                    "Dioxyde de carbone (CO2)",
                    "H√©lium (He)"
                ],
                "a": 2,
                "exp": "Le CO2 est le gaz actif principal en MAP car il se dissout dans la phase aqueuse et grasse, abaissant le pH et inhibant la croissance microbienne.",
                "f": "Azotegenerateur.pdf",
                "l": "https://drive.google.com/uc?export=download&id=1YPj6GDWhTPCBvReBXmJZbxUSMRiBC5Lo"
            },
            {
                "day": 22,
                "q": "Quelle est la d√©finition d'un 'Nouvel Aliment' (Novel Food) selon le R√®glement (UE) 2015/2283 ?",
                "o": [
                    "Un aliment riche en vitamines",
                    "Un aliment dont la consommation humaine √©tait n√©gligeable dans l'Union avant le 15 mai 1997",
                    "Un aliment contenant des additifs",
                    "Un aliment produit en laboratoire uniquement"
                ],
                "a": 1,
                "exp": "La date pivot est le 15 mai 1997. Tout aliment non consomm√© significativement avant cette date n√©cessite une autorisation avant mise sur le march√©.",
                "f": "ravageur boulangerie.pdf",
                "l": "https://drive.google.com/uc?export=download&id=17wJgepcdg_LZG81l4fjkEfqxRdW6KVpq"
            },
            {
                "day": 23,
                "q": "Selon le R√®glement (CE) n¬∞ 1333/2008, qu'est-ce qu'un additif alimentaire ?",
                "o": [
                    "Un ingr√©dient agricole normal",
                    "Une substance non consomm√©e comme aliment en soi, ajout√©e intentionnellement pour un but technologique",
                    "Un contaminant environnemental",
                    "Une aide technologique √©limin√©e en fin de process"
                ],
                "a": 1,
                "exp": "L'additif est ajout√© intentionnellement pour des raisons technologiques (conservation, coloration, texture) et se retrouve dans le produit fini.",
                "f": "nutriscore.pdf",
                "l": "https://drive.google.com/uc?export=download&id=1cQhaliuP3vtysRedSVlwTK1r22hlqOQG"
            },
            {
                "day": 24,
                "q": "Quelle norme ISO d√©finit les exigences relatives aux syst√®mes de management de la s√©curit√© des denr√©es alimentaires ?",
                "o": [
                    "ISO 9001",
                    "ISO 14001",
                    "ISO 22000",
                    "ISO 45001"
                ],
                "a": 2,
                "exp": "L'ISO 22000 est la norme internationale sp√©cifique au management de la s√©curit√© des denr√©es alimentaires, int√©grant l'HACCP.",
                "f": "aircomprim√©.pdf",
                "l": "https://drive.google.com/uc?export=download&id=13fM84mzhhpxkok5qHj64SJB6BFFvkxdk"
            },
            {
                "day": 25,
                "q": "Selon le R√®glement (UE) n¬∞ 10/2011, quel est le symbole utilis√© pour indiquer qu'un mat√©riau est apte au contact alimentaire ?",
                "o": [
                    "Un triangle de recyclage",
                    "Un verre et une fourchette",
                    "Une poubelle barr√©e",
                    "Une t√™te de mort"
                ],
                "a": 1,
                "exp": "Le symbole 'verre et fourchette' indique que le mat√©riau est destin√© √† entrer en contact avec des denr√©es alimentaires.",
                "f": "Listeria2026.pdf",
                "l": "https://drive.google.com/uc?export=download&id=1LM00Eg7Z2YVgRg7hOSFU6f4tJaBG2XRa"
            }
        ];

        const now = new Date();
        const curDay = now.getDate();
        const isDec = (now.getMonth() === 11);

        // VOS IMAGES GITHUB POUR LE FOND D'ECRAN
        const bgs = [
            "https://raw.githubusercontent.com/Visitune/AVENTCALIFS/main/asset/chad-madden-SUTfFCAHV_A-unsplash.jpg",
            "https://raw.githubusercontent.com/Visitune/AVENTCALIFS/main/asset/freestocks--Qf9JKLysUg-unsplash.jpg",
            "https://raw.githubusercontent.com/Visitune/AVENTCALIFS/main/asset/annie-spratt-VDXtVYJVj7A-unsplash.jpg",
            "https://raw.githubusercontent.com/Visitune/AVENTCALIFS/main/asset/joanna-kosinska-i7q-HTO0SEM-unsplash.jpg",
            "https://raw.githubusercontent.com/Visitune/AVENTCALIFS/main/asset/kieran-white-SBdmQcW8qag-unsplash.jpg",
            "https://raw.githubusercontent.com/Visitune/AVENTCALIFS/main/asset/louis-magnotti-Kf8ko_oGN20-unsplash.jpg",
            "https://raw.githubusercontent.com/Visitune/AVENTCALIFS/main/asset/tessa.jpg"
        ];

        function initBackground() {
            const bgIndex = curDay % bgs.length;
            const imgUrl = bgs[bgIndex];
            const img = new Image();
            img.onload = () => {
                document.body.style.backgroundImage = `url('${imgUrl}')`;
                fadeOutLoader();
            };
            // Fallback (on garde la premi√®re si erreur)
            img.onerror = () => fadeOutLoader();
            img.src = imgUrl;
        }

        function fadeOutLoader() {
            const l = document.getElementById('loader');
            l.style.opacity = '0';
            setTimeout(() => l.style.display='none', 500);
        }

        function initCalendar() {
            const grid = document.getElementById('grid');
            if(!QUIZ_DATA || QUIZ_DATA.length === 0) {
                grid.innerHTML = "<h3 style='background:rgba(0,0,0,0.8); padding:20px; border-radius:10px;'>‚ö†Ô∏è Donn√©es manquantes (Admin JSON)</h3>";
                fadeOutLoader();
                return;
            }

            let unlocked = 0;

            QUIZ_DATA.forEach(item => {
                let status = "locked";
                if (MODE_DEMO) {
                    status = (item.day <= curDay) ? "past" : "open";
                    if (item.day === curDay) status = "today";
                } else if (isDec) {
                    if (item.day < curDay) status = "past";
                    else if (item.day === curDay) status = "today";
                }

                if(status !== 'locked') unlocked++;

                const type = Math.floor(Math.random() * 3);
                let shapeClass = "shape-snowflake"; 
                if(type === 1) shapeClass = "shape-ball";
                else if(type === 2) shapeClass = "shape-gift";

                const box = document.createElement('div');
                // On utilise les classes shape-xxx qui ont maintenant des background-image
                box.className = `day-box ${shapeClass} ${status}`;
                box.innerHTML = `<div class="day-number">${item.day}</div>`;

                if(status !== 'locked') {
                    box.onclick = () => openModal(item);
                }

                grid.appendChild(box);
            });

            const pct = (unlocked / QUIZ_DATA.length) * 100;
            document.getElementById('progressBar').style.width = pct + '%';
            document.getElementById('progressTxt').innerText = `${unlocked}/${QUIZ_DATA.length}`;
        }

        function forceDownloadLink(url) {
            if(!url) return "#";
            if(url.includes("export=download")) return url;
            const match = url.match(/\/d\/(.+?)\/|id=(.+?)($|&)/);
            if(match) return `https://drive.google.com/uc?export=download&id=${match[1] || match[2]}`;
            return url;
        }

        let currentItem = null;
        const modal = document.getElementById('quizModal');

        function openModal(item) {
            currentItem = item;
            document.getElementById('m-day').innerText = `Jour ${item.day}`;
            document.getElementById('m-question').innerText = item.q;
            document.getElementById('m-feedback').style.display = 'none';
            modal.classList.add('visible');

            const opts = document.getElementById('m-options');
            opts.innerHTML = "";
            item.o.forEach((txt, i) => {
                const btn = document.createElement('button');
                btn.className = "option-btn";
                btn.innerText = txt;
                btn.onclick = () => checkAnswer(i, btn);
                opts.appendChild(btn);
            });
        }

        function checkAnswer(idx, btn) {
            const btns = document.querySelectorAll('.option-btn');
            btns.forEach(b => b.disabled = true);

            const isCorrect = (idx === currentItem.a);
            btn.classList.add(isCorrect ? 'correct' : 'incorrect');
            
            const audio = document.getElementById(isCorrect ? 'snd-win' : 'snd-fail');
            try { audio.currentTime=0; audio.play(); } catch(e){}

            if(!isCorrect) {
                if(btns[currentItem.a]) btns[currentItem.a].classList.add('correct');
            }

            document.getElementById('m-exp').innerHTML = (isCorrect ? "‚úÖ <b>Exact !</b> " : "‚ùå <b>Incorrect.</b> ") + (currentItem.exp || "");
            const link = document.getElementById('m-link');
            link.href = forceDownloadLink(currentItem.l);
            link.innerHTML = `üì• ${currentItem.f || 'T√©l√©charger'}`;
            
            document.getElementById('m-feedback').style.display = 'block';
        }

        function closeModal() { modal.classList.remove('visible'); }

        function startSnow(){
            const cvs = document.getElementById('snowCanvas');
            const ctx = cvs.getContext('2d');
            let w, h, flakes=[];
            const rz = ()=>{w=cvs.width=window.innerWidth; h=cvs.height=window.innerHeight;};
            window.addEventListener('resize', rz); rz();
            for(let i=0;i<50;i++) flakes.push({x:Math.random()*w,y:Math.random()*h,r:Math.random()*3+1,s:Math.random()+0.5});
            function draw(){
                ctx.clearRect(0,0,w,h); ctx.fillStyle="rgba(255,255,255,0.6)"; ctx.beginPath();
                flakes.forEach(f=>{ctx.moveTo(f.x,f.y);ctx.arc(f.x,f.y,f.r,0,Math.PI*2);f.y+=f.s;if(f.y>h)f.y=-5;});
                ctx.fill(); requestAnimationFrame(draw);
            }
            draw();
        }

        startSnow();
        initBackground();
        initCalendar();

    </script>
</body>
</html>
